# GPU 호환성 가이드

ACE-Step 1.5는 GPU의 사용 가능한 VRAM에 자동으로 적응하여 생성 제한 및 LM 모델 가용성을 적절히 조정합니다. 시스템은 시작 시 GPU 메모리를 감지하고 최적의 설정을 구성합니다.

## GPU 티어 구성

| VRAM | 티어 | LM 모드 | 최대 생성 길이 | 최대 배치 크기 | LM 메모리 할당 |
|------|------|---------|--------------|----------------|---------------------|
| ≤4GB | 티어 1 | 사용 불가 | 3분 | 1 | - |
| 4-6GB | 티어 2 | 사용 불가 | 6분 | 1 | - |
| 6-8GB | 티어 3 | 0.6B (선택 사항) | LM 사용 시: 4분 / 미사용 시: 6분 | LM 사용 시: 1 / 미사용 시: 2 | 3GB |
| 8-12GB | 티어 4 | 0.6B (선택 사항) | LM 사용 시: 4분 / 미사용 시: 6분 | LM 사용 시: 2 / 미사용 시: 4 | 3GB |
| 12-16GB | 티어 5 | 0.6B / 1.7B | LM 사용 시: 4분 / 미사용 시: 6분 | LM 사용 시: 2 / 미사용 시: 4 | 0.6B: 3GB, 1.7B: 8GB |
| 16-24GB | 티어 6 | 0.6B / 1.7B / 4B | 8분 | LM 사용 시: 4 / 미사용 시: 8 | 0.6B: 3GB, 1.7B: 8GB, 4B: 12GB |
| ≥24GB | 제한 없음 | 모든 모델 | 10분 | 8 | 제한 없음 |

## 참고 사항

- **기본 설정**은 감지된 GPU 메모리에 따라 자동으로 구성됩니다.
- **LM 모드**는 Chain-of-Thought 생성 및 오디오 이해에 사용되는 언어 모델을 의미합니다.
- 최적의 성능을 위해 **Flash Attention**, **CPU Offload**, **Compile**, **Quantization**이 기본적으로 활성화됩니다.
- GPU 제한을 초과하는 길이 또는 배치 크기를 요청하면 경고가 표시되고 값이 제한됩니다.
- **제약 디코딩 (Constrained Decoding)**: LM이 초기화되면 LM의 길이 생성도 GPU 티어의 최대 길이 제한으로 제약되어 CoT 생성 중 메모리 부족(OOM) 에러를 방지합니다.
- VRAM이 6GB 이하인 GPU의 경우, DiT 모델의 메모리 확보를 위해 LM 초기화가 기본적으로 비활성화됩니다.
- 명령줄 인자(CLI) 또는 Gradio UI를 통해 설정을 수동으로 무시할 수 있습니다.

> **커뮤니티 기여 환영**: 위의 GPU 티어 구성은 일반적인 하드웨어에서의 테스트를 바탕으로 합니다. 사용 중인 장치의 실제 성능이 이 파라미터와 다르다면(예: 더 긴 길이나 더 큰 배치를 처리할 수 있는 경우), 더 철저한 테스트를 수행하고 `acestep/gpu_config.py`에서 이러한 구성을 최적화하기 위한 PR을 제출해 주시기 바랍니다. 여러분의 기여가 모든 사용자의 경험을 개선하는 데 도움이 됩니다!

## 메모리 최적화 팁

1. **낮은 VRAM (8GB 미만)**: 최대 길이를 확보하려면 LM 초기화 없이 DiT 전용 모드를 사용하세요.
2. **중간 VRAM (8-16GB)**: 품질과 메모리의 최적의 균형을 위해 0.6B LM 모델을 사용하세요.
3. **높은 VRAM (16GB 초과)**: 더 나은 오디오 이해 및 생성 품질을 위해 더 큰 LM 모델(1.7B/4B)을 활성화하세요.

## 디버그 모드: 다른 GPU 구성 시뮬레이션

테스트 및 개발을 위해 `MAX_CUDA_VRAM` 환경 변수를 사용하여 다른 GPU 메모리 크기를 시뮬레이션할 수 있습니다:

```bash
# 4GB GPU 시뮬레이션 (티어 1)
MAX_CUDA_VRAM=4 uv run acestep

# 8GB GPU 시뮬레이션 (티어 4)
MAX_CUDA_VRAM=8 uv run acestep

# 12GB GPU 시뮬레이션 (티어 5)
MAX_CUDA_VRAM=12 uv run acestep

# 16GB GPU 시뮬레이션 (티어 6)
MAX_CUDA_VRAM=16 uv run acestep
```

이는 다음과 같은 경우에 유용합니다:
- 고사양 하드웨어에서 GPU 티어 구성 테스트
- 각 티어에 대해 경고 및 제한이 올바르게 작동하는지 확인
- PR 제출 전 새로운 GPU 구성 파라미터 개발 및 테스트
